<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="record">

<select id="subjectDifftime" parameterType="string" resultType="SubjectDifftimeDto">
select SUBJECT_ID, SUBJECT_NAME ,DIFFTIME    
from (SELECT SUBJECT_ID, SUBJECT_NAME  FROM SUBJECT WHERE MEM_ID =#{memId} AND SUBJECT_DEL_DATE IS NULL) t1   
	FULL JOIN 
	( SELECT RECORD_SUBJECT_ID, SUBSTR(NUMTODSINTERVAL( SUM( CAST(RECORD_END as DATE) - CAST(RECORD_START as DATE) ), 'day' ), 12, 8) as DIFFTIME 
	  FROM RECORD WHERE RECORD_MEM_ID = #{memId}  and to_char(RECORD_START, 'yyyymmdd') =  to_char(SYSDATE, 'yyyymmdd') 
	  group by cube(RECORD_SUBJECT_ID) ) t2 
	on (SUBJECT_ID = RECORD_SUBJECT_ID) 
ORDER BY SUBJECT_ID ASC NULLS FIRST
</select>

<select id="selectOne" parameterType="int" resultType="RecordDto">
SELECT * FROM RECORD WHERE RECORD_ID=#{recordId}
</select>

<select id="select" resultType="RecordDto">
SELECT * FROM RECORD
</select>

<insert id="insertStartTime" parameterType="RecordTimeDto">
INSERT INTO RECORD VALUES(SEQ_RECORD_ID.nextval, #{recordSubjectId}, #{recordMemId},
 	to_date(#{recordStart}, 'yyyymmddhh24miss'),NULL)
</insert>

<update id="insertEndTime" parameterType="RecordTimeDto">
UPDATE RECORD SET RECORD_END = to_date(#{recordStart}, 'yyyymmddhh24miss')
 where RECORD_SUBJECT_ID =#{recordSubjectId} and RECORD_MEM_ID=#{recordMemId}
</update>

</mapper>
